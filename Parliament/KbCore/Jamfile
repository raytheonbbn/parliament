# Parliament is licensed under the BSD License from the Open Source
# Initiative, http://www.opensource.org/licenses/bsd-license.php
#
# Copyright (c) 2001-2009, BBN Technologies, Inc.
# All rights reserved.

import common ;
import h ;
import make ;
import os ;
import path ;

project /KB/KbCore ;

path-constant JavaSrcDir : ../java ;
path-constant JenaLibDir : ../lib/default ;

GeneratedJniHeaderDir = [ os.environ GENERATED_JNI_HEADER_DIR ] ;
InstallLocation = [ os.environ NATIVE_CODE_INSTALL_DIR ] ;
InstallLocation ?= $(JamRootDir)/target/drop-box ;

install distribution
	:	FixupParliamentPath
	:	<location>$(InstallLocation)
		<install-dependencies>on
		<install-type>SHARED_LIB
	:	# default build
	:	# usage requirements
	;

lib FixupParliamentPath
	:	DllMain.cpp FixupParliamentPath.cpp
		/site-config//BoostHeaderOnlyLibraries
		/site-config//JavaJNI
	:	<include>.
		<include>$(GeneratedJniHeaderDir)
		<define>BUILDING_KBCORE
		<visibility>hidden
		<threading>multi
		<os>NT:<source>Version.rc
		<os>LINUX:<source>/KB//DynamicLinkLib
	:	# default build
	:	<include>.
	;

lib Parliament
	:	[ glob *.cpp : FixupParliamentPath.cpp Utf8StaticInitGen.cpp ]
		/site-config//BerkeleyDB
		/site-config//BoostHeaderOnlyLibraries
		/site-config//BoostAtomic
		/site-config//BoostChrono
		/site-config//BoostFileSystem
		/site-config//BoostLog
		/site-config//BoostLogSetup
		/site-config//BoostThread
		/site-config//JavaJNI
	:	<include>.
		<include>$(GeneratedJniHeaderDir)
		<define>BUILDING_KBCORE
		<visibility>hidden
		<threading>multi
		<os>NT:<source>Version.rc
		<os>LINUX:<source>/KB//DynamicLinkLib
	:	# default build
	:	<include>.
	;

exe Utf8StaticInitGen
	:	Utf8StaticInitGen.cpp
	:	<include>.
		<define>PARLIAMENT_SUPPRESS_AUTOLINK
		<visibility>hidden
		<threading>multi
	;
